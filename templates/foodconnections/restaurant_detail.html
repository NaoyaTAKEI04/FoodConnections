{% extends './base.html' %}
{% load static %}
{% block content %}

{% if messages %}
<div class="messages">
    {% for messeage in messages %}
      <p class="alert {% if messeage.tags %} alert-{{ messeage.tags }} {% endif %}">{{ messeage }}</p>
    {% endfor %}
</div>
{% endif %}

<h1>{{ restaurant.name }}</h1>
<p>{{ restaurant.ruby }}</p>

{% if restaurant.image %}
    <img src="{{ restaurant.image.url }}" class="card-img-top"  width=100% height="400" alt="{{ restaurant.name }}">
{% else %}
    <img src="{% static 'foodconnections/images/no_image.png' %}" width=100% height="400" alt="No Image">
{% endif %}

<div>
    <p>カテゴリー：{{ restaurant.category.name }}</p>
    <p>住所：{{ restaurant.address }}</p>

    <iframe 
      id="map" 
      src='https://www.google.com/maps/embed/v1/place?key=AIzaSyAc8wQYCFhOebruAJSX0ZH7pGJ56wBhg84&q={{ restaurant.address }}'
      width="100%"
      height="320"
      frameborder="0">
    </iframe>
</div>

<h4>{{ restaurant.catchphrase }}</h4>
<p>{{ restaurant.comment }}</p>

<!-- レビューの表示 -->
<h4>この店舗のレビュー</h4>
{% if reviews %}
<p>平均評価: {{ average_score }} / 5.0  ({{ total_reviews }}件)</p>
<ul>
    {% for review in reviews %}
        <li>
            <p>タイトル: {{review.title}}</p>
            <p>{{ review.user.username }} さんの評価: {{ review.score }}</p>
            <p>コメント: {{ review.comment }}</p>
        </li>
    {% endfor %}
</ul>
{% else %}
<p>口コミはまだありません。</p>
{% endif %}

<!-- レビューの投稿フォーム -->
<h4>レビューを投稿する</h4>
<form method="post" action="{% url 'foodconnections:review_create' restaurant.pk %}">
{% csrf_token %}
{{ review_form.as_p }}
{% if user.is_authenticated %}
    <button type="submit">投稿する</button>
{% else %}
    <button disabled type="submit">投稿する</button>
    <p>レビュー投稿にはログインが必要です。</p>
{% endif %}
</form>

<a href="{% url 'foodconnections:top_page' %}" class="btn btn-primary">一覧</a>
<a href="{% url 'foodconnections:update' restaurant.pk %}" class="btn btn-primary">編集</a>
<a href="{% url 'foodconnections:delete' restaurant.pk %}" class="btn btn-secondary">削除</a>

{% endblock %}