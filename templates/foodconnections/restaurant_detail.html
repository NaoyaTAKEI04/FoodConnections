{% extends './base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}

<!--リダイレクト時のメッセージ表示-->
{% if messages %}
<div class="messages">
    {% for messeage in messages %}
      <p class="alert {% if messeage.tags %} alert-{{ messeage.tags }} {% endif %}">{{ messeage }}</p>
    {% endfor %}
</div>
{% endif %}

<h1 class="font-weight-bold mt-3">{{ restaurant.name }}</h1>
<p class="mt-1">{{ restaurant.ruby }}</p>

<!--Google Map-->
{% if restaurant.image %}
    <img src="{{ restaurant.image.url }}" class="card-img-top"  width=100% height="400" alt="{{ restaurant.name }}">
{% else %}
    <img src="{% static 'foodconnections/images/no_image.png' %}" width=100% height="400" alt="No Image">
{% endif %}

<div class="mt-3">
    <p class="mt-1">{{ restaurant.category.name }}</p>
    <p class="mt-1">住所：{{ restaurant.address }}</p>

    <iframe 
      id="map" 
      src='https://www.google.com/maps/embed/v1/place?key=AIzaSyAc8wQYCFhOebruAJSX0ZH7pGJ56wBhg84&q={{ restaurant.address }}'
      width="100%"
      height="320"
      frameborder="0"
      class="mt-3">
    </iframe>
</div>

<h4 class="font-weight-bold mt-5">{{ restaurant.catchphrase }}</h4>
<p class="mt-3">{{ restaurant.comment }}</p>

<!-- レビューの表示 -->
<h4 class="mt-5">この店舗のレビュー</h4>
{% if reviews %}
<p class="mt-3">平均評価: {{ average_score }} / 5.0  ({{ total_reviews }}件)</p>
<ul class="mt-3">
    {% for review in reviews %}
        <ul class="border-bottom mt-1">
            <div class="row">
                <h5 class="font-weight-bold col-sm-6 mt-1">{{review.title}}</h5>
                <p class="text-right col-sm-6 mt-1">({{ review.user.username }} さん)</p>
            </div>
            <div class="row">
                <p class="col-sm-6 mt-1">評価：{{ review.score }}</p>
                <p class="text-right col-sm-6 mt-1">{{ review.created_at }}</p>
            </div>
            <p class="mt-1">{{ review.comment }}</p>
        </ul>
    {% endfor %}
</ul>
{% else %}
<p class="mt-3">口コミはまだありません。</p>
{% endif %}

<!-- レビューの投稿フォーム -->
<h4 class="mt-5">レビューを投稿する</h4>
<form method="post" action="{% url 'foodconnections:review_create' restaurant.pk %}">
{% csrf_token %}
{{ review_form|crispy }}
{% if user.is_authenticated %}
    <button type="submit" class="mb-5">投稿する</button>
{% else %}
    <button disabled type="submit" class="mv-5">投稿する</button>
    <p>レビュー投稿にはログインが必要です。</p>
{% endif %}
</form>

<div>
    <a href="JavaScript:history.back()">&lt; 戻る</a>
</div>

{% endblock %}